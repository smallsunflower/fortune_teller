import gradio as gr
from datetime import datetime
import calendar

# å¤©å¹²åœ°æ”¯æ•°æ®
TIANGAN = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
DIZHI = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]
SHENGXIAO = ["é¼ ", "ç‰›", "è™", "å…”", "é¾™", "è›‡", "é©¬", "ç¾Š", "çŒ´", "é¸¡", "ç‹—", "çŒª"]
WUXING = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"]

# å¤©å¹²å¯¹åº”äº”è¡Œ
TIANGAN_WUXING = {
    "ç”²": "æœ¨", "ä¹™": "æœ¨",
    "ä¸™": "ç«", "ä¸": "ç«",
    "æˆŠ": "åœŸ", "å·±": "åœŸ",
    "åºš": "é‡‘", "è¾›": "é‡‘",
    "å£¬": "æ°´", "ç™¸": "æ°´"
}

# åœ°æ”¯å¯¹åº”äº”è¡Œ
DIZHI_WUXING = {
    "å­": "æ°´", "äº¥": "æ°´",
    "å¯…": "æœ¨", "å¯": "æœ¨",
    "å·³": "ç«", "åˆ": "ç«",
    "ç”³": "é‡‘", "é…‰": "é‡‘",
    "è¾°": "åœŸ", "æˆŒ": "åœŸ", "ä¸‘": "åœŸ", "æœª": "åœŸ"
}

# æ—¶è¾°å¯¹åº”åœ°æ”¯
SHICHEN = {
    (23, 1): "å­", (1, 3): "ä¸‘", (3, 5): "å¯…", (5, 7): "å¯",
    (7, 9): "è¾°", (9, 11): "å·³", (11, 13): "åˆ", (13, 15): "æœª",
    (15, 17): "ç”³", (17, 19): "é…‰", (19, 21): "æˆŒ", (21, 23): "äº¥"
}

# çº³éŸ³äº”è¡Œï¼ˆç®€åŒ–ç‰ˆï¼‰
NAYIN = {
    "ç”²å­": "æµ·ä¸­é‡‘", "ä¹™ä¸‘": "æµ·ä¸­é‡‘", "ä¸™å¯…": "ç‚‰ä¸­ç«", "ä¸å¯": "ç‚‰ä¸­ç«",
    "æˆŠè¾°": "å¤§æ—æœ¨", "å·±å·³": "å¤§æ—æœ¨", "åºšåˆ": "è·¯æ—åœŸ", "è¾›æœª": "è·¯æ—åœŸ",
    "å£¬ç”³": "å‰‘é”‹é‡‘", "ç™¸é…‰": "å‰‘é”‹é‡‘", "ç”²æˆŒ": "å±±å¤´ç«", "ä¹™äº¥": "å±±å¤´ç«"
}


def get_bazi(year, month, day, hour):
    """è®¡ç®—å…«å­—"""
    # å¹´æŸ±
    year_gan_idx = (year - 4) % 10
    year_zhi_idx = (year - 4) % 12
    year_gan = TIANGAN[year_gan_idx]
    year_zhi = DIZHI[year_zhi_idx]
    
    # æœˆæŸ±ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
    month_gan_idx = (year_gan_idx * 2 + month) % 10
    month_zhi = DIZHI[(month + 1) % 12]
    month_gan = TIANGAN[month_gan_idx]
    
    # æ—¥æŸ±ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
    day_gan_idx = (year * 5 + month * 2 + day) % 10
    day_zhi_idx = (year * 5 + month * 2 + day) % 12
    day_gan = TIANGAN[day_gan_idx]
    day_zhi = DIZHI[day_zhi_idx]
    
    # æ—¶æŸ±
    hour_zhi = get_shichen(hour)
    hour_zhi_idx = DIZHI.index(hour_zhi)
    hour_gan_idx = (day_gan_idx * 2 + hour_zhi_idx) % 10
    hour_gan = TIANGAN[hour_gan_idx]
    
    return {
        "year": f"{year_gan}{year_zhi}",
        "month": f"{month_gan}{month_zhi}",
        "day": f"{day_gan}{day_zhi}",
        "hour": f"{hour_gan}{hour_zhi}",
        "year_gan": year_gan,
        "year_zhi": year_zhi,
        "day_gan": day_gan,
        "day_zhi": day_zhi
    }


def get_shichen(hour):
    """æ ¹æ®å°æ—¶è·å–æ—¶è¾°"""
    for (start, end), zhi in SHICHEN.items():
        if start <= hour < end or (start == 23 and hour == 23):
            return zhi
    return "å­"


def calculate_wuxing(bazi):
    """è®¡ç®—äº”è¡Œå¼ºå¼±"""
    wuxing_count = {"æœ¨": 0, "ç«": 0, "åœŸ": 0, "é‡‘": 0, "æ°´": 0}
    
    # ç»Ÿè®¡å¤©å¹²äº”è¡Œ
    for key in ["year", "month", "day", "hour"]:
        gan = bazi[key][0]
        wuxing_count[TIANGAN_WUXING[gan]] += 1
    
    # ç»Ÿè®¡åœ°æ”¯äº”è¡Œ
    for key in ["year", "month", "day", "hour"]:
        zhi = bazi[key][1]
        wuxing_count[DIZHI_WUXING[zhi]] += 1
    
    return wuxing_count


def get_xing_personality(name):
    """æ ¹æ®å§“åè®¡ç®—æ€§æ ¼ç‰¹å¾ï¼ˆç®€åŒ–ç‰ˆå§“åå­¦ï¼‰"""
    name_value = sum(ord(c) for c in name) % 5
    personalities = [
        "æ€§æ ¼åšéŸ§ï¼Œæ„å¿—åŠ›å¼ºï¼Œå¯Œæœ‰åˆ›é€ åŠ›",
        "æ€§æ ¼çƒ­æƒ…ï¼Œç§¯æè¿›å–ï¼Œå–„äºè¡¨è¾¾",
        "æ€§æ ¼ç¨³é‡ï¼Œè¸å®å¯é ï¼ŒåŒ…å®¹å¤§åº¦",
        "æ€§æ ¼ç†æ€§ï¼Œæ€ç»´æ•æ·ï¼Œæ³¨é‡ç»†èŠ‚",
        "æ€§æ ¼çµæ´»ï¼Œå–„äºå˜é€šï¼Œå¯Œæœ‰æ™ºæ…§"
    ]
    return personalities[name_value]


def analyze_fortune(name, gender, year, month, day, hour, minute):
    """ç»¼åˆåˆ†æè¿åŠ¿"""
    try:
        # è®¡ç®—å…«å­—
        bazi = get_bazi(year, month, day, hour)
        
        # è®¡ç®—äº”è¡Œ
        wuxing = calculate_wuxing(bazi)
        
        # æ‰¾å‡ºæœ€å¼ºå’Œæœ€å¼±çš„äº”è¡Œ
        max_element = max(wuxing, key=wuxing.get)
        min_element = min(wuxing, key=wuxing.get)
        
        # æ—¥ä¸»äº”è¡Œ
        rizhu_wuxing = TIANGAN_WUXING[bazi["day_gan"]]
        
        # ç”Ÿè‚–
        shengxiao = SHENGXIAO[(year - 4) % 12]
        
        # åŸºç¡€ä¿¡æ¯
        basic_info = f"""
ã€åŸºæœ¬ä¿¡æ¯ã€‘
å§“åï¼š{name}
æ€§åˆ«ï¼š{gender}
å‡ºç”Ÿæ—¶é—´ï¼š{year}å¹´{month}æœˆ{day}æ—¥ {hour}æ—¶{minute}åˆ†
ç”Ÿè‚–ï¼š{shengxiao}

ã€å…«å­—å‘½ç›˜ã€‘
å¹´æŸ±ï¼š{bazi['year']}
æœˆæŸ±ï¼š{bazi['month']}
æ—¥æŸ±ï¼š{bazi['day']}ï¼ˆæ—¥ä¸»ï¼š{bazi['day_gan']}ï¼‰
æ—¶æŸ±ï¼š{bazi['hour']}

ã€äº”è¡Œåˆ†å¸ƒã€‘
æœ¨ï¼š{'â˜…' * wuxing['æœ¨']} ({wuxing['æœ¨']})
ç«ï¼š{'â˜…' * wuxing['ç«']} ({wuxing['ç«']})
åœŸï¼š{'â˜…' * wuxing['åœŸ']} ({wuxing['åœŸ']})
é‡‘ï¼š{'â˜…' * wuxing['é‡‘']} ({wuxing['é‡‘']})
æ°´ï¼š{'â˜…' * wuxing['æ°´']} ({wuxing['æ°´']})

æ—¥ä¸»äº”è¡Œï¼š{rizhu_wuxing}
å‘½ä¸­æœ€æ—ºï¼š{max_element}
éœ€è¦è¡¥å……ï¼š{min_element}

ã€æ€§æ ¼ç‰¹å¾ã€‘
{get_xing_personality(name)}
        """
        
        # æ ¹æ®äº”è¡Œåˆ†æè¿åŠ¿
        fortune = analyze_detailed_fortune(name, gender, bazi, wuxing, rizhu_wuxing, max_element, min_element)
        
        return basic_info, fortune
        
    except Exception as e:
        return f"è®¡ç®—å‡ºé”™ï¼š{str(e)}", ""


def analyze_detailed_fortune(name, gender, bazi, wuxing, rizhu, max_elem, min_elem):
    """è¯¦ç»†è¿åŠ¿åˆ†æ"""
    current_month = datetime.now().month
    current_day = datetime.now().day
    
    # è´¢è¿åˆ†æ
    if max_elem in ["é‡‘", "åœŸ"]:
        caiyun = f"""ğŸ’° ã€è´¢è¿ã€‘â­â­â­â­
å‘½ä¸­{max_elem}æ—ºï¼Œä¸»è´¢è¿äº¨é€šã€‚è¿‘æœŸæ­£è´¢è¿åŠ¿è¾ƒå¼ºï¼Œå·¥ä½œæ”¶å…¥ç¨³å®šã€‚
å»ºè®®ï¼šæœ¬æœˆé€‚åˆè¿›è¡Œç¨³å¥æŠ•èµ„ï¼Œ{current_day}æ—¥åæœ‰è´µäººç›¸åŠ©ï¼Œè´¢è¿æ›´æ—ºã€‚
å¿Œï¼šé¿å…åœ¨{(current_day + 7) % 30}æ—¥å‰åè¿›è¡Œé«˜é£é™©æŠ•èµ„ã€‚
å¼€è¿è‰²ï¼šé‡‘è‰²ã€é»„è‰²ã€‚"""
    elif max_elem == "æ°´":
        caiyun = f"""ğŸ’° ã€è´¢è¿ã€‘â­â­â­â­â­
æ°´ä¸ºè´¢æºï¼Œå‘½ä¸­æ°´æ—ºè€…è´¢è¿æä½³ã€‚è¿‘æœŸåè´¢è¿å¼ºï¼Œå¯å°è¯•å¤šå…ƒåŒ–æ”¶å…¥ã€‚
å»ºè®®ï¼šæœ¬æœˆ{current_day + 3}æ—¥åé€‚åˆå•†åŠ¡æ´½è°ˆï¼Œç­¾çº¦æ—¶æœºæˆç†Ÿã€‚
å¿Œï¼š{current_month}æœˆ{(current_day + 10) % 30}æ—¥å‰åéœ€è°¨é˜²ç ´è´¢ã€‚
å¼€è¿è‰²ï¼šè“è‰²ã€é»‘è‰²ã€‚"""
    else:
        caiyun = f"""ğŸ’° ã€è´¢è¿ã€‘â­â­â­
è´¢è¿å¹³ç¨³ï¼Œéœ€ç¨³æ‰ç¨³æ‰“ã€‚æ”¶å…¥æ¥æºä»¥æ­£è´¢ä¸ºä¸»ã€‚
å»ºè®®ï¼šè¿‘æœŸå®œå®ˆä¸å®œæ”»ï¼Œå¤šç§¯ç´¯å°‘èŠ±è´¹ï¼Œ{current_day + 5}æ—¥åè´¢è¿æ¸æ—ºã€‚
å¿Œï¼šé¿å…å†²åŠ¨æ¶ˆè´¹ã€‚
å¼€è¿æ–¹ä½ï¼šè¥¿æ–¹ã€åŒ—æ–¹ã€‚"""
    
    # çˆ±æƒ…è¿åŠ¿
    if gender == "ç”·":
        if max_elem in ["ç«", "æœ¨"]:
            aiqing = f"""ğŸ’• ã€çˆ±æƒ…ã€‘â­â­â­â­â­
å‘½ä¸­æ¡ƒèŠ±æ—ºç››ï¼Œé­…åŠ›åè¶³ã€‚å•èº«è€…è¿‘æœŸæ˜“é‡è‰¯ç¼˜ã€‚
å»ºè®®ï¼šæœ¬æœˆ{current_day + 2}æ—¥è‡³{current_day + 12}æ—¥ä¸ºæ¡ƒèŠ±æ—ºæœŸï¼Œå¤šå‚åŠ ç¤¾äº¤æ´»åŠ¨ã€‚
æœ‰ä¼´è€…æ„Ÿæƒ…å‡æ¸©ï¼Œé€‚åˆæ±‚å©šæˆ–æ·±å…¥å‘å±•ã€‚
å¼€è¿åœ°ç‚¹ï¼šå’–å•¡å…ã€è‰ºæœ¯å±•è§ˆã€‚"""
        else:
            aiqing = f"""ğŸ’• ã€çˆ±æƒ…ã€‘â­â­â­
æ„Ÿæƒ…è¿åŠ¿å¹³ç¨³ï¼Œéœ€ä¸»åŠ¨å‡ºå‡»ã€‚å•èº«è€…å®œæ‰©å¤§ç¤¾äº¤åœˆã€‚
å»ºè®®ï¼šå¤šä¸æœ‹å‹èšä¼šï¼Œå¯èƒ½é€šè¿‡æœ‹å‹ä»‹ç»é‡åˆ°åˆé€‚å¯¹è±¡ã€‚
æœ‰ä¼´è€…éœ€è¦å¤šæ²Ÿé€šï¼Œå¢è¿›ç†è§£ã€‚
å¼€è¿æ—¥ï¼šå‘¨äº”ã€å‘¨å…­ã€‚"""
    else:
        if max_elem in ["æ°´", "é‡‘"]:
            aiqing = f"""ğŸ’• ã€çˆ±æƒ…ã€‘â­â­â­â­
æ¡ƒèŠ±è¿ä½³ï¼Œå¼‚æ€§ç¼˜å¼ºã€‚å•èº«è€…æœ‰æœ›é‡åˆ°å¿ƒä»ªå¯¹è±¡ã€‚
å»ºè®®ï¼šä¿æŒä¼˜é›…å¾—ä½“çš„å½¢è±¡ï¼Œ{current_day + 4}æ—¥åæ¡ƒèŠ±æ›´æ—ºã€‚
æœ‰ä¼´è€…æ„Ÿæƒ…ç”œèœœï¼Œå¯è€ƒè™‘è¿›ä¸€æ­¥å‘å±•ã€‚
å¼€è¿ç©¿æ­ï¼šæ·¡é›…è‰²ç³»ã€‚"""
        else:
            aiqing = f"""ğŸ’• ã€çˆ±æƒ…ã€‘â­â­â­
æ„Ÿæƒ…éœ€è¦ç”¨å¿ƒç»è¥ã€‚å•èº«è€…å‹¿æ€¥èºï¼Œç¼˜åˆ†è‡ªä¼šåˆ°æ¥ã€‚
å»ºè®®ï¼šæå‡è‡ªæˆ‘ä¿®å…»ï¼Œå……å®å†…åœ¨ç¾ã€‚
æœ‰ä¼´è€…éœ€è¦æ›´å¤šè€å¿ƒå’ŒåŒ…å®¹ã€‚
å¼€è¿æ´»åŠ¨ï¼šè¯»ä¹¦ã€è¿åŠ¨ã€‚"""
    
    # äº‹ä¸šè¿åŠ¿
    if rizhu in ["æœ¨", "ç«"]:
        shiye = f"""ğŸ† ã€äº‹ä¸šã€‘â­â­â­â­â­
æ—¥ä¸»{rizhu}ï¼Œä¸»äº‹ä¸šå…´æ—ºã€‚è¿‘æœŸå·¥ä½œè¿åŠ¿æä½³ï¼Œæ˜“è·é¢†å¯¼èµè¯†ã€‚
å»ºè®®ï¼šæœ¬æœˆ{current_day + 1}æ—¥è‡³{current_day + 15}æ—¥ä¸ºäº‹ä¸šä¸Šå‡æœŸï¼Œå¯ä¸»åŠ¨æ‰¿æ‹…é‡è¦é¡¹ç›®ã€‚
æœºé‡ï¼šæœ‰æ™‹å‡æˆ–åŠ è–ªå¯èƒ½ï¼ŒæŠŠæ¡ä½{current_month}æœˆ{(current_day + 8) % 30}æ—¥å‰åçš„å…³é”®æ—¶æœºã€‚
å¿Œï¼šé¿å…ä¸åŒäº‹å‘ç”Ÿå†²çªï¼Œ{(current_day + 13) % 30}æ—¥éœ€ä½è°ƒå¤„äº‹ã€‚"""
    else:
        shiye = f"""ğŸ† ã€äº‹ä¸šã€‘â­â­â­â­
å·¥ä½œè¿åŠ¿ç¨³ä¸­æœ‰å‡ï¼Œéœ€è„šè¸å®åœ°ã€‚
å»ºè®®ï¼šè®¤çœŸå®Œæˆæœ¬èŒå·¥ä½œï¼Œç§¯ç´¯ç»éªŒå’Œäººè„‰ã€‚
æœºé‡ï¼šæœˆä¸­å¯èƒ½æœ‰æ–°çš„é¡¹ç›®æœºä¼šï¼Œå¥½å¥½æŠŠæ¡ã€‚
å¿Œï¼šä¸å®œé¢‘ç¹è·³æ§½ï¼Œç¨³å®šå‘å±•ä¸ºä¸Šã€‚"""
    
    # å¥åº·è¿åŠ¿
    if min_elem == "ç«":
        jiankang = f"""ğŸ¥ ã€å¥åº·ã€‘â­â­â­
å‘½ä¸­ç¼º{min_elem}ï¼Œéœ€æ³¨æ„å¿ƒè¡€ç®¡ã€çœ¼ç›æ–¹é¢å¥åº·ã€‚
å»ºè®®ï¼šå¤šæ™’å¤ªé˜³ï¼Œé€‚å½“è¿åŠ¨ï¼Œä¿æŒå¿ƒæƒ…æ„‰æ‚¦ã€‚
é¥®é£Ÿï¼šå¤šåƒçº¢è‰²é£Ÿç‰©ï¼ˆçº¢æ£ã€ç•ªèŒ„ç­‰ï¼‰ï¼Œå°‘é£Ÿå¯’å‡‰ã€‚
æ³¨æ„ï¼š{current_day + 6}æ—¥å‰åæ³¨æ„ä¼‘æ¯ï¼Œé¿å…è¿‡åº¦åŠ³ç´¯ã€‚
å…»ç”Ÿæ–¹ä½ï¼šå—æ–¹ã€‚"""
    elif min_elem == "æ°´":
        jiankang = f"""ğŸ¥ ã€å¥åº·ã€‘â­â­â­
å‘½ä¸­ç¼º{min_elem}ï¼Œéœ€æ³¨æ„è‚¾è„ã€æ³Œå°¿ç³»ç»Ÿå¥åº·ã€‚
å»ºè®®ï¼šå¤šé¥®æ°´ï¼Œè§„å¾‹ä½œæ¯ï¼Œé¿å…ç†¬å¤œã€‚
é¥®é£Ÿï¼šå¤šåƒé»‘è‰²é£Ÿç‰©ï¼ˆé»‘è±†ã€é»‘èŠéº»ç­‰ï¼‰ã€‚
æ³¨æ„ï¼šå†¬å­£éœ€ç‰¹åˆ«ä¿æš–ï¼Œé˜²æ­¢æ„Ÿå†’ã€‚
å…»ç”Ÿæ–¹ä½ï¼šåŒ—æ–¹ã€‚"""
    else:
        jiankang = f"""ğŸ¥ ã€å¥åº·ã€‘â­â­â­â­
æ•´ä½“å¥åº·è¿åŠ¿è‰¯å¥½ï¼Œæ³¨æ„åŠ³é€¸ç»“åˆã€‚
å»ºè®®ï¼šä¿æŒè§„å¾‹ä½œæ¯ï¼Œé€‚åº¦è¿åŠ¨ï¼Œå‡è¡¡é¥®é£Ÿã€‚
æ³¨æ„ï¼šæ¢å­£æ—¶èŠ‚æ³¨æ„å¢å‡è¡£ç‰©ã€‚
å…»ç”Ÿï¼šå¯å°è¯•å¤ªæã€ç‘œä¼½ç­‰æ¸©å’Œè¿åŠ¨ã€‚"""
    
    # å­¦ä¸šè¿åŠ¿
    if max_elem in ["æœ¨", "æ°´"]:
        xueye = f"""ğŸ“š ã€å­¦ä¸šã€‘â­â­â­â­â­
å‘½ä¸­{max_elem}æ—ºï¼Œä¸»æ™ºæ…§èªé¢–ï¼Œå­¦ä¹ è¿åŠ¿æä½³ã€‚
å»ºè®®ï¼šè¿‘æœŸæ€ç»´æ´»è·ƒï¼Œé€‚åˆå­¦ä¹ æ–°çŸ¥è¯†ã€è€ƒå–è¯ä¹¦ã€‚
è€ƒè¯•è¿ï¼š{current_month}æœˆ{(current_day + 9) % 30}æ—¥å‰åè€ƒè¿æœ€ä½³ã€‚
å­¦ä¹ æ–¹æ³•ï¼šæ™¨è¯»æ•ˆæœæœ€å¥½ï¼Œ{current_day + 3}æ—¥è‡³{current_day + 18}æ—¥ä¸ºå­¦ä¹ é»„é‡‘æœŸã€‚
å¼€è¿æ–‡å…·ï¼šä½¿ç”¨è“è‰²æˆ–ç»¿è‰²ç¬”è®°æœ¬ã€‚"""
    else:
        xueye = f"""ğŸ“š ã€å­¦ä¸šã€‘â­â­â­â­
å­¦ä¹ è¿åŠ¿å¹³ç¨³ä¸Šå‡ï¼Œéœ€æŒä¹‹ä»¥æ’ã€‚
å»ºè®®ï¼šåˆ¶å®šå­¦ä¹ è®¡åˆ’ï¼ŒæŒ‰éƒ¨å°±ç­å®Œæˆã€‚
è€ƒè¯•è¿ï¼šä¿æŒå¹³å¸¸å¿ƒï¼Œç¨³å®šå‘æŒ¥ã€‚
å­¦ä¹ æ–¹æ³•ï¼šå¤šåšç»ƒä¹ ï¼Œå·©å›ºåŸºç¡€ã€‚
å¼€è¿ï¼šå¯åœ¨ä¹¦æ¡Œæ‘†æ”¾æ–‡æ˜Œå¡”æˆ–ç»¿æ¤ã€‚"""
    
    # ç»¼åˆå»ºè®®
    lucky_color = get_lucky_color(max_elem)
    lucky_number = get_lucky_number(wuxing)
    
    suggestions = f"""
ğŸŒŸ ã€æœ¬æœˆç»¼åˆå»ºè®®ã€‘
âœ¦ å¹¸è¿é¢œè‰²ï¼š{lucky_color}
âœ¦ å¹¸è¿æ•°å­—ï¼š{lucky_number}
âœ¦ å¹¸è¿æ–¹ä½ï¼š{get_lucky_direction(max_elem)}
âœ¦ è´µäººå±ç›¸ï¼š{get_guiren_shengxiao(bazi['year_zhi'])}
âœ¦ å¼€è¿å»ºè®®ï¼š{get_kaiyun_advice(max_elem, min_elem)}

ã€åŒ–è§£æ–¹æ³•ã€‘
é’ˆå¯¹äº”è¡Œç¼º{min_elem}çš„æƒ…å†µï¼š
{get_huajie_method(min_elem)}

ã€æ¯æ—¥å‰æ—¶ã€‘
æ—©ä¸Š {get_lucky_hour(bazi['day_zhi'], 0)}
ä¸‹åˆ {get_lucky_hour(bazi['day_zhi'], 1)}

ğŸ“¿ æ„¿æ‚¨è¯¸äº‹é¡ºé‚ï¼Œä¸‡äº‹å¦‚æ„ï¼
    """
    
    return caiyun + "\n\n" + aiqing + "\n\n" + shiye + "\n\n" + jiankang + "\n\n" + xueye + "\n\n" + suggestions


def get_lucky_color(element):
    """è·å–å¹¸è¿è‰²"""
    colors = {
        "æœ¨": "é’è‰²ã€ç»¿è‰²",
        "ç«": "çº¢è‰²ã€ç´«è‰²",
        "åœŸ": "é»„è‰²ã€æ£•è‰²",
        "é‡‘": "ç™½è‰²ã€é‡‘è‰²",
        "æ°´": "é»‘è‰²ã€è“è‰²"
    }
    return colors.get(element, "ç™½è‰²")


def get_lucky_number(wuxing):
    """è·å–å¹¸è¿æ•°å­—"""
    max_elem = max(wuxing, key=wuxing.get)
    numbers = {
        "æœ¨": "3ã€8",
        "ç«": "2ã€7",
        "åœŸ": "5ã€10",
        "é‡‘": "4ã€9",
        "æ°´": "1ã€6"
    }
    return numbers.get(max_elem, "6ã€8")


def get_lucky_direction(element):
    """è·å–å¹¸è¿æ–¹ä½"""
    directions = {
        "æœ¨": "ä¸œæ–¹",
        "ç«": "å—æ–¹",
        "åœŸ": "ä¸­å¤®",
        "é‡‘": "è¥¿æ–¹",
        "æ°´": "åŒ—æ–¹"
    }
    return directions.get(element, "ä¸œæ–¹")


def get_guiren_shengxiao(year_zhi):
    """è·å–è´µäººå±ç›¸"""
    guiren_map = {
        "å­": "ç‰›ã€çŒ´", "ä¸‘": "é¼ ã€è›‡",
        "å¯…": "çŒªã€é©¬", "å¯": "ç‹—ã€ç¾Š",
        "è¾°": "é¸¡ã€çŒ´", "å·³": "çŒ´ã€é¼ ",
        "åˆ": "ç¾Šã€è™", "æœª": "é©¬ã€å…”",
        "ç”³": "è›‡ã€é¼ ", "é…‰": "é¾™ã€çŒ´",
        "æˆŒ": "å…”ã€é©¬", "äº¥": "è™ã€çŒª"
    }
    return guiren_map.get(year_zhi, "é¾™ã€é©¬")


def get_kaiyun_advice(max_elem, min_elem):
    """è·å–å¼€è¿å»ºè®®"""
    advice_map = {
        "æœ¨": "å¤šæ¥è§¦å¤§è‡ªç„¶ï¼Œæ‘†æ”¾ç»¿æ¤",
        "ç«": "å¤šæ™’å¤ªé˜³ï¼Œä¿æŒçƒ­æƒ…",
        "åœŸ": "è„šè¸å®åœ°ï¼Œç¨³å¥å‘å±•",
        "é‡‘": "æ³¨é‡ç»†èŠ‚ï¼Œç†æ€§å†³ç­–",
        "æ°´": "ä¿æŒçµæ´»ï¼Œé¡ºåŠ¿è€Œä¸º"
    }
    return f"å‘æŒ¥{max_elem}çš„ä¼˜åŠ¿â€”â€”{advice_map.get(max_elem, 'ä¿æŒå¹³å¸¸å¿ƒ')}"


def get_huajie_method(element):
    """è·å–åŒ–è§£æ–¹æ³•"""
    methods = {
        "æœ¨": "â€¢ ä½©æˆ´æœ¨è´¨é¥°å“æˆ–ç»¿è‰²æ°´æ™¶\nâ€¢ å¤šå»å…¬å›­ã€æ£®æ—ç­‰ç»¿è‰²ç¯å¢ƒ\nâ€¢ æˆ¿é—´æ‘†æ”¾ç»¿è‰²æ¤ç‰©",
        "ç«": "â€¢ ç©¿ç€çº¢è‰²è¡£ç‰©\nâ€¢ å¤šæ™’å¤ªé˜³ï¼Œä¿æŒå……è¶³å…‰ç…§\nâ€¢ ä½©æˆ´çº¢ç›ç‘™ã€çŸ³æ¦´çŸ³ç­‰",
        "åœŸ": "â€¢ ä½©æˆ´é»„æ°´æ™¶ã€ç¥ç€\nâ€¢ å¤šæ¥è§¦åœŸåœ°ï¼Œå¦‚å›­è‰º\nâ€¢ ä½¿ç”¨é»„è‰²ã€æ£•è‰²ç‰©å“",
        "é‡‘": "â€¢ ä½©æˆ´é‡‘é“¶é¦–é¥°\nâ€¢ ä½¿ç”¨ç™½è‰²ã€é‡‘è‰²ç‰©å“\nâ€¢ å¯ä½©æˆ´ç™½æ°´æ™¶",
        "æ°´": "â€¢ å¤šé¥®æ°´ï¼Œä¿æŒæ°´åˆ†\nâ€¢ ä½©æˆ´é»‘æ›œçŸ³ã€è“å®çŸ³\nâ€¢ ä½¿ç”¨é»‘è‰²ã€è“è‰²ç‰©å“"
    }
    return methods.get(element, "ä¿æŒå¹³å¸¸å¿ƒ")


def get_lucky_hour(day_zhi, period):
    """è·å–å‰æ—¶"""
    morning_hours = ["è¾°æ—¶(7-9ç‚¹)", "å·³æ—¶(9-11ç‚¹)", "å¯æ—¶(5-7ç‚¹)"]
    afternoon_hours = ["æœªæ—¶(13-15ç‚¹)", "ç”³æ—¶(15-17ç‚¹)", "é…‰æ—¶(17-19ç‚¹)"]
    
    zhi_idx = DIZHI.index(day_zhi) if day_zhi in DIZHI else 0
    
    if period == 0:
        return morning_hours[zhi_idx % 3]
    else:
        return afternoon_hours[zhi_idx % 3]


# åˆ›å»º Gradio ç•Œé¢
def create_interface():
    with gr.Blocks(title="å…«å­—ç®—å‘½ç³»ç»Ÿ", theme=gr.themes.Soft()) as demo:
        gr.Markdown(
            """
            # ğŸ”® å…«å­—ç®—å‘½ç³»ç»Ÿ
            ### åŸºäºå¤©å¹²åœ°æ”¯äº”è¡Œç†è®ºï¼Œä¸ºæ‚¨è§£æäººç”Ÿè¿åŠ¿
            ---
            """
        )
        
        with gr.Row():
            with gr.Column(scale=1):
                gr.Markdown("### ğŸ“ è¯·è¾“å…¥æ‚¨çš„ä¿¡æ¯")
                name_input = gr.Textbox(label="å§“å", placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å")
                gender_input = gr.Radio(["ç”·", "å¥³"], label="æ€§åˆ«", value="ç”·")
                
                with gr.Row():
                    year_input = gr.Number(label="å‡ºç”Ÿå¹´ä»½", value=1990, precision=0)
                    month_input = gr.Number(label="å‡ºç”Ÿæœˆä»½", value=1, precision=0, minimum=1, maximum=12)
                
                with gr.Row():
                    day_input = gr.Number(label="å‡ºç”Ÿæ—¥æœŸ", value=1, precision=0, minimum=1, maximum=31)
                    hour_input = gr.Number(label="å‡ºç”Ÿå°æ—¶", value=12, precision=0, minimum=0, maximum=23)
                
                minute_input = gr.Number(label="å‡ºç”Ÿåˆ†é’Ÿ", value=0, precision=0, minimum=0, maximum=59)
                
                calculate_btn = gr.Button("ğŸ”® å¼€å§‹æµ‹ç®—", variant="primary", size="lg")
                
                gr.Markdown(
                    """
                    ---
                    ğŸ’¡ **æ¸©é¦¨æç¤º**
                    - è¯·å‡†ç¡®å¡«å†™å‡ºç”Ÿä¿¡æ¯
                    - æ—¶è¾°å¯¹å‘½ç†å½±å“é‡å¤§
                    - ä»…ä¾›å¨±ä¹å‚è€ƒ
                    """
                )
            
            with gr.Column(scale=2):
                gr.Markdown("### ğŸ“Š å‘½ç†åˆ†æç»“æœ")
                basic_output = gr.Textbox(label="åŸºæœ¬å‘½ç›˜", lines=20, show_copy_button=True)
                fortune_output = gr.Textbox(label="è¿åŠ¿è¯¦è§£", lines=25, show_copy_button=True)
        
        calculate_btn.click(
            fn=analyze_fortune,
            inputs=[name_input, gender_input, year_input, month_input, day_input, hour_input, minute_input],
            outputs=[basic_output, fortune_output]
        )
        
        gr.Markdown(
            """
            ---
            <div style="text-align: center; color: #666;">
                <p>âš ï¸ æœ¬ç³»ç»Ÿä»…ä¾›å¨±ä¹å‚è€ƒï¼Œè¯·å‹¿è¿‡åˆ†è¿·ä¿¡</p>
                <p>ğŸŒŸ å‘½è¿æŒæ¡åœ¨è‡ªå·±æ‰‹ä¸­ï¼ŒåŠªåŠ›æ‰æ˜¯æˆåŠŸçš„å…³é”®</p>
            </div>
            """
        )
    
    return demo


if __name__ == "__main__":
    demo = create_interface()
    demo.launch(server_name="0.0.0.0", server_port=7860, share=False)
